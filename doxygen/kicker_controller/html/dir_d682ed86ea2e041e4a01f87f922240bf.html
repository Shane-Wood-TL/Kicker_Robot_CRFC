<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Kicker Controller: managed_components/espressif__esp-now/examples/ota Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Kicker Controller
   </div>
   <div id="projectbrief">Senior Design Project 2025 for the Controller for the Kicker Robot</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_230ff1e69d1001871a4401f345fc5388.html">managed_components</a></li><li class="navelem"><a class="el" href="dir_53b0c73583c5ec3ac167a7c3a40a70e1.html">espressif__esp-now</a></li><li class="navelem"><a class="el" href="dir_a284544a182ea467cb5e8d18d1856e3a.html">examples</a></li><li class="navelem"><a class="el" href="dir_d682ed86ea2e041e4a01f87f922240bf.html">ota</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">ota Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="subdirs" name="subdirs"></a>
Directories</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><span class="iconfclosed"></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_e439f716f7a0dcdc542581cce7ea52a9.html">main</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This example demonstrates how to use ESP-NOW OTA feature to help upgrading other devices.</p>
<h1><a class="anchor" id="autotoc_md102"></a>
Hardware Required</h1>
<p>This example can run on any ESP32 series boards and at least two development boards are required, 1 works as initiator, and the others work as responders.</p>
<h1><a class="anchor" id="autotoc_md103"></a>
Configuration</h1>
<p>Open the project configuration menu (<code>idf.py menuconfig</code>) to configure the OTA mode and firmware upgrade URL (Refer to Kconfig file).</p>
<h1><a class="anchor" id="autotoc_md104"></a>
How to Use the Example</h1>
<p><img src="../../docs/_static/en/OTA_workflow.png" alt="" width="550" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md105"></a>
Step 1: Connect to the router</h2>
<p>Connect PC to the router, the <code>ESP-NOW OTA Initiator Device</code> will connect to this router later.</p>
<h2><a class="anchor" id="autotoc_md106"></a>
Step 2: Run HTTP server</h2>
<p>A built-in python HTTP server can be used as the server for the example upgrade. Open a new terminal to run the HTTP server, and then run the below command to generate the firmware to be upgraded and start the server. </p><div class="fragment"><div class="line">cd $IDF_PATH/examples/get-started/hello_world/</div>
<div class="line">idf.py build</div>
<div class="line">cd build</div>
<div class="line">python -m http.server 8070</div>
</div><!-- fragment --><p>While the server is running, you may open this <code><a href="http://localhost:8070/">http://localhost:8070/</a></code> in browse to check the build directory.</p>
<blockquote class="doxtable">
<p>Note: </p>
</blockquote>
<ol type="1">
<li>If there are firewall softwares that prevent any access to the port 8070, please grant the access while the example is running.</li>
</ol>
<h2><a class="anchor" id="autotoc_md107"></a>
Step 3: Build &amp; Flash &amp; Run the responders</h2>
<p>Navigate to the OTA example directory, and type <code>idf.py menuconfig</code> to configure the OTA example.</p>
<p>Set following configurations under <code>Example Connection Configuration</code> Options:</p><ul>
<li>Set <code>WiFi SSID</code> of the Router (Access-Point).</li>
<li>Set <code>WiFi Password</code> of the Router (Access-Point).</li>
</ul>
<p>Set following configurations under <code>Example Configuration</code> Options:</p><ul>
<li>Set <code>ESP-NOW mode</code> to <code>Responder Mode</code></li>
</ul>
<p>When downloading the flash, it's recommend to use <code>erase_flash</code> to erase the entire flash memory (all the remaining data in ota_data partition will be deleted as well) for the first time, and then write the followings via a serial port:</p>
<div class="fragment"><div class="line">idf.py erase_flash flash</div>
</div><!-- fragment --><p>When the example on the responder device starts up, it will:</p>
<ol type="1">
<li>Connect to the AP with configured SSID and password.</li>
<li>Create OTA task to receive OTA frames.</li>
<li>Response with OTA information if receives OTA request frame.</li>
<li>Write the image to flash if receives OTA image data. If receives all the image, configure the next boot from this image.</li>
<li>If reboot the device, it will run to the new image.</li>
</ol>
<h2><a class="anchor" id="autotoc_md108"></a>
Step 4: Build &amp; Flash &amp; Run the initiator</h2>
<p>Navigate to the OTA example directory, and type <code>idf.py menuconfig</code> to configure the OTA example.</p>
<p>Set following configurations under <code>Example Connection Configuration</code> Options:</p><ul>
<li>Set <code>WiFi SSID</code> of the Router (Access-Point).</li>
<li>Set <code>WiFi Password</code> of the Router (Access-Point).</li>
</ul>
<p>Set following configurations under <code>Example Configuration</code> Options:</p><ul>
<li>Set <code>ESP-NOW mode</code> to <code>Initiator Mode</code></li>
<li>Set firmware upgrade URL</li>
</ul>
<div class="fragment"><div class="line">http://&lt;host-ip-address&gt;:&lt;host-port&gt;/&lt;firmware-image-filename&gt;</div>
<div class="line"> </div>
<div class="line">for e.g,</div>
<div class="line">http://192.168.0.3:8070/hello-world.bin</div>
</div><!-- fragment --><p>When downloading the flash, it's recommend to use <code>erase_flash</code> to erase the entire flash memory (all the remaining data in ota_data partition will be deleted as well) for the first time, and then write the followings via a serial port:</p>
<div class="fragment"><div class="line">idf.py erase_flash flash</div>
</div><!-- fragment --><p>When the example on the initiator device starts up, it will:</p>
<ol type="1">
<li>Connect to the AP with configured SSID and password.</li>
<li>Connect to the HTTP server and download the new image.</li>
<li>Scan OTA responders and get responder list.</li>
<li>Send the new image in ESP-NOW data to responders until all responders have finished upgrading or sending times reach CONFIG_ESPNOW_OTA_RETRY_COUNT.</li>
</ol>
<h1><a class="anchor" id="autotoc_md109"></a>
Example Output</h1>
<p>Note that the output, in particular the order of the output, may vary depending on the environment.</p>
<p>Console output of the initiator: </p><div class="fragment"><div class="line">I (4460) example_connect: Connected to example_connect: sta</div>
<div class="line">I (4466) example_connect: - IPv4 address: 192.168.1.100</div>
<div class="line">I (4472) example_connect: - IPv6 address: fe80:0000:0000:0000:7edf:a1ff:fe76:4238, type: ESP_IP6_ADDR_IS_LINK_LOCAL</div>
<div class="line">I (4484) wifi:Set ps type: 0</div>
<div class="line"> </div>
<div class="line">I (4487) ESPNOW: espnow [version: 1.0] init</div>
<div class="line">I (4491) app_main: Open HTTP connection: http://192.168.1.106:8070/hello-world.bin</div>
<div class="line">I (6164) app_main: The service download firmware is complete, Spend time: 1s</div>
<div class="line">I (6165) esp_image: segment 0: paddr=001f0020 vaddr=3c020020 size=05f48h ( 24392) map</div>
<div class="line">I (6172) esp_image: segment 1: paddr=001f5f70 vaddr=3fc89c00 size=01a84h (  6788) </div>
<div class="line">I (6179) esp_image: segment 2: paddr=001f79fc vaddr=40380000 size=0861ch ( 34332) </div>
<div class="line">I (6189) esp_image: segment 3: paddr=00200020 vaddr=42000020 size=1516ch ( 86380) map</div>
<div class="line">I (6203) esp_image: segment 4: paddr=00215194 vaddr=4038861c size=014b0h (  5296) </div>
<div class="line">I (6204) esp_image: segment 5: paddr=0021664c vaddr=50000000 size=00010h (    16) </div>
<div class="line">W (8321) app_main: espnow wait ota num: 1</div>
<div class="line">I (8321) espnow_ota_initatior: [espnow_ota_initiator_send, 301]: total_size: 157312, packet_num: 697</div>
<div class="line">I (9180) espnow_ota_initatior: count: 0, Upgrade_initiator_send, requested_num: 1, unfinished_num: 1, successed_num: 0</div>
<div class="line">I (11260) espnow_ota_initatior: count: 1, Upgrade_initiator_send, requested_num: 1, unfinished_num: 1, successed_num: 0</div>
<div class="line">I (11412) app_main: Firmware is sent to the device to complete, Spend time: 5s</div>
<div class="line">I (11412) app_main: Devices upgrade completed, successed_num: 1, unfinished_num: 0</div>
</div><!-- fragment --><p> Console output of the responder: </p><div class="fragment"><div class="line">I (4473) example_connect: Connected to example_connect: sta</div>
<div class="line">I (4479) example_connect: - IPv4 address: 192.168.1.102</div>
<div class="line">I (4485) example_connect: - IPv6 address: fe80:0000:0000:0000:7edf:a1ff:fe86:d824, type: ESP_IP6_ADDR_IS_LINK_LOCAL</div>
<div class="line">I (4496) wifi:Set ps type: 0</div>
<div class="line"> </div>
<div class="line">I (4499) ESPNOW: espnow [version: 1.0] init</div>
<div class="line">I (425039) espnow_ota_responder: The device starts to upgrade</div>
<div class="line">I (427993) espnow_ota_responder: Write total_size: 157312, written_size: 157312, spend time: 2s</div>
<div class="line">I (427994) espnow_ota_responder: Running firmware version: v1.0-beta1-10-gbb5d5ec-dirty</div>
<div class="line">I (428000) espnow_ota_responder: Running firmware version: v4.3.1-dirty</div>
<div class="line">I (428007) esp_image: segment 0: paddr=001f0020 vaddr=3c020020 size=05f48h ( 24392) map</div>
<div class="line">I (428018) esp_image: segment 1: paddr=001f5f70 vaddr=3fc89c00 size=01a84h (  6788) </div>
<div class="line">I (428025) esp_image: segment 2: paddr=001f79fc vaddr=40380000 size=0861ch ( 34332) </div>
<div class="line">I (428036) esp_image: segment 3: paddr=00200020 vaddr=42000020 size=1516ch ( 86380) map</div>
<div class="line">I (428050) esp_image: segment 4: paddr=00215194 vaddr=4038861c size=014b0h (  5296) </div>
<div class="line">I (428051) esp_image: segment 5: paddr=0021664c vaddr=50000000 size=00010h (    16) </div>
</div><!-- fragment --><p> When responder device reboots, it will output: </p><div class="fragment"><div class="line">Hello world!</div>
<div class="line">This is esp32c3 chip with 1 CPU core(s), WiFi/BLE, silicon revision 3, 4MB external flash</div>
<div class="line">Minimum free heap size: 328644 bytes</div>
<div class="line">Restarting in 10 seconds...</div>
<div class="line">Restarting in 9 seconds...</div>
<div class="line">Restarting in 8 seconds...</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md110"></a>
Troubleshooting</h1>
<ul>
<li>Check your PC can ping the ESP32 at its IP, and that the IP, AP and other configuration settings are correct in menuconfig.</li>
<li>Check if any firewall software is preventing incoming connections on the PC.</li>
<li><p class="startli">Check whether you can get firmware (default hello-world.bin), by checking the output of following command:</p>
<div class="fragment"><div class="line">curl -v http：// &lt;host-ip-address&gt;：&lt;host-port&gt; / &lt;firmware-image-filename&gt;</div>
</div><!-- fragment --></li>
<li>If you have another PC or a phone, try viewing the file listing from the separate host.</li>
</ul>
<h2><a class="anchor" id="autotoc_md111"></a>
errors “ota_begin error err = 0x104”</h2>
<p>If you see this error then check that the configured (and actual) flash size is large enough for the partitions in the partition table. The default "two OTA slots" partition table only works with 4 MB flash size. To use OTA with smaller flash sizes, create a custom partition table CSV (look in components/partition_table) and configure it in menuconfig. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2
</small></address>
</div><!-- doc-content -->
</body>
</html>
